{% extends "layout.html" %}

{% block title %}Proximity Setup - BioSecure{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1>Proximity Data Setup</h1>
        <p class="lead">Configure key and mobile proximity settings for enhanced security</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-lg-8 mx-auto">
        <div class="instructions-panel">
            <h5><i class="bi bi-info-circle me-2"></i>Instructions</h5>
            <ul>
                <li>Set up at least one proximity identifier (key ID, mobile device, Bluetooth, or NFC)</li>
                <li>Generate random identifiers or scan for nearby devices</li>
                <li>The more proximity methods you configure, the more secure your authentication will be</li>
                <li>You can update these settings at any time</li>
            </ul>
        </div>
    </div>
</div>

<div id="proximity-setup-container" class="container">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Proximity Configuration</h5>
                </div>
                <div class="card-body">
                    <form id="proximity-form" method="POST" action="{{ url_for('biometrics.proximity_setup') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="mb-4">
                            <h6><i class="bi bi-key me-2"></i>Key Proximity</h6>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="key-proximity-id" name="key_proximity_id" placeholder="Enter key identifier" value="{{ proximity_data.key_proximity_id if proximity_data else '' }}">
                                <button class="btn btn-outline-secondary" type="button" id="generate-key-id-button">
                                    Generate
                                </button>
                            </div>
                            <div class="form-text">
                                A unique identifier for your physical key or key fob
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6><i class="bi bi-phone me-2"></i>Mobile Device Proximity</h6>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="mobile-device-id" name="mobile_device_id" placeholder="Enter mobile device identifier" value="{{ proximity_data.mobile_device_id if proximity_data else '' }}">
                                <button class="btn btn-outline-secondary" type="button" id="generate-mobile-id-button">
                                    Generate
                                </button>
                            </div>
                            <div class="form-text">
                                A unique identifier for your smartphone or mobile device
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6><i class="bi bi-bluetooth me-2"></i>Bluetooth Proximity</h6>
                            <div class="alert alert-info" id="bluetooth-warning" style="display: none;"></div>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="bluetooth-address" name="bluetooth_address" placeholder="Bluetooth device address" value="{{ proximity_data.bluetooth_address if proximity_data else '' }}">
                                <button class="btn btn-outline-secondary" type="button" id="scan-bluetooth-button">
                                    Scan for Devices
                                </button>
                            </div>
                            <div id="scanning-indicator" style="display: none;">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">Scanning...</span>
                                </div>
                                <span class="ms-2">Scanning for Bluetooth devices...</span>
                            </div>
                            <div id="selected-device-info" class="mt-2 text-success" style="display: none;"></div>
                        </div>

                        <div class="mt-3">
                            <div id="detected-devices" class="list-group device-list mb-3"></div>
                        </div>

                        <div class="mb-4">
                            <h6><i class="bi bi-upc-scan me-2"></i>NFC Tag</h6>
                            <div class="alert alert-info" id="nfc-warning" style="display: none;"></div>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="nfc-tag-id" name="nfc_tag_id" placeholder="NFC tag identifier" value="{{ proximity_data.nfc_tag_id if proximity_data else '' }}">
                                <button class="btn btn-outline-secondary" type="button" id="scan-nfc-button" disabled>
                                    Scan NFC Tag
                                </button>
                            </div>
                            <div class="form-text">
                                A unique identifier for your NFC tag or card
                            </div>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save me-1"></i> Save Proximity Settings
                            </button>
                            <a href="{{ url_for('profile.dashboard') }}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/proximity.js') }}"></script>
{% endblock %}
